
---

### 📌 LeetCode 8：字符串转换整数（atoi）  
**题目要求**：  
实现一个函数，将输入字符串按规则转换为 32 位有符号整数。规则包括：
1. 忽略前导空格；
2. 读取可选的正负号；
3. 尽可能多地读取连续数字字符；
4. 遇到非数字字符或字符串结束则停止；
5. 若结果超出 `[INT_MIN, INT_MAX]` 范围，则返回边界值。

---

### ✅ 正确解法（状态解析 + 溢出预判）

```cpp
/*
 * @lc app=leetcode.cn id=8 lang=cpp
 *
 * [8] 字符串转换整数 (atoi)
 */
#include <iostream>
#include <string>
#include <climits>  // 必须包含以使用 INT_MAX / INT_MIN
using namespace std;

class Solution {
public:
    int myAtoi(string s) {
        int n = s.size();
        int i = 0;

        // 1. 跳过前导空格
        while (i < n && s[i] == ' ') {
            i++;
        }

        // 2. 处理符号
        int sign = 1;
        if (i < n && (s[i] == '+' || s[i] == '-')) {
            sign = (s[i] == '-') ? -1 : 1;
            i++;
        }

        // 3. 转换数字并处理溢出
        int num = 0;
        while (i < n && s[i] >= '0' && s[i] <= '9') {
            int digit = s[i] - '0';

            // 溢出预判：在更新 num 前检查是否越界
            if (num > INT_MAX / 10 || (num == INT_MAX / 10 && digit > INT_MAX % 10)) {
                return sign == 1 ? INT_MAX : INT_MIN;
            }

            num = num * 10 + digit;
            i++;
        }

        return sign * num;
    }
};
```

> 🔧 **修正说明**：  
> - 原代码中使用了 `&`（按位与），应改为逻辑与 `&&`；  
> - 溢出判断条件建议写成更清晰的形式：`num > INT_MAX / 10` 或 `num == INT_MAX / 10 && digit > 7`（因为 `INT_MAX = 2147483647`，末位是 7）。

---

### 💡 反思与关键教训

#### ❌ 思维固化陷阱
- 上一题（125 验证回文串）刚用过 `isalnum()`，本题**错误地试图复用该函数**来判断数字字符。
- **问题本质**：`isalnum(c)` 包含字母（如 `'a'`），但 `atoi` **只接受数字字符 `'0'-'9'`**。混淆“字母数字”与“纯数字”导致逻辑错误。

#### ✅ 正确做法
- **不要过度依赖通用函数**，而应根据题意精准判断：
  ```cpp
  // 正确：仅判断数字
  if (c >= '0' && c <= '9')
  // 错误：会把 'a', 'Z' 等也当作有效字符
  if (isalnum(c))
  ```
- **分阶段解析字符串**是处理复杂转换类问题的核心策略：
  1. 跳空白 → 2. 读符号 → 3. 累加数字（带溢出检查）

#### ⚠️ 溢出处理要点
- **不能先计算再判断**（如 `num * 10 + digit > INT_MAX`），因为此时已溢出，行为未定义。
- **必须提前预判**：在执行 `num = num * 10 + digit` 前，检查：
  ```cpp
  if (num > INT_MAX / 10) → 必溢出
  if (num == INT_MAX / 10 && digit > 7) → 正数溢出（INT_MAX 末位是 7）
  if (num == INT_MAX / 10 && digit > 8) → 负数溢出（INT_MIN = -2147483648，绝对值末位是 8）
  ```

---

### 🧠 经验总结

| 场景 | 推荐方法 |
|------|--------|
| 判断是否为数字字符 | `c >= '0' && c <= '9'` 或 `isdigit(c)`（来自 `<cctype>`） |
| 判断是否为字母或数字 | `isalnum(c)`（用于回文、过滤等场景） |
| 整数溢出防护 | **在运算前预判**，利用 `INT_MAX / 10` 和 `INT_MAX % 10` |

> ✨ **核心思想**：**每道题的需求不同，工具要按需选用，切忌“上一题用了这个，这题也硬套”**。

---

### 🔜 后续练习建议
- 手写 `myAtoi` 时不看代码，重点训练：
  - 三阶段解析流程；
  - 溢出条件的准确书写；
  - 边界测试用例（如 `"   +0 123"`, `"-91283472332"`）。
- 对比 `isdigit(c)` 与手动判断的差异，理解标准库函数的适用边界。

---
